<% include header.html %>

<script type="text/javascript">
	<!-- websocket handlers -->
	var socket = io.connect('http://<%= server%>:<%= port%>');	

	socket.on('connected', function(data){
		if(data.status == 'ok'){
			addLog('server connected');	
		}
	});

	socket.on('crawler running status', function(data){
		if(data.status == "starting"){
			$('#startGlobalCrawler').html('运行中');
		}

		if(data.status == "finished"){
			$('#startGlobalCrawler').html('启动');
			$('#startGlobalCrawler').prop('disabled', false);
		}
	});


</script>

<script type="text/javascript">
	<!-- other methods -->
	function startGlobalCrawler(){
		socket.emit('start global crawler', {schedule : 'immediately'});
		$('#startGlobalCrawler').prop('disabled', true);
	}

	function addLog(l){
		$('#logPlace').val(l + "\n" + $('#logPlace').val());
	}

	function clearLog(){
		$('#logPlace').val("");
	}

	function globalCrawlerInfo(){
		window.location.hash = "global";
		socket.emit("get crawler info", {type : "global"});
	}
</script>

<div class="container">
	<div class="caption" style="margin-bottom:30px; margin-top:0; padding-top:0">
		<h3>Crawler Monitor</h3>
	</div>
	<div class="col-md-2 well" style="margin: 10px">
		<div>
			<ul class="nav nav-pills nav-stacked">
				<li><a href="javascript:void(0)" onclick="javascript:globalCrawlerInfo()">全局</a></li>
				<li><a href="#">交易</a></li>
				<li><hr/></li>
				<li><a href="#">品牌主数据</a></li>
				<li><a href="#">品种主数据</a></li>
				<li><a href="#">单品主数据</a></li>
				<li><a href="#">店铺主数据</a></li>
				<li><hr/></li>
				<li><a href="#">指定品牌</a></li>
				<li><a href="#">指定店铺</a></li>
			</ul>
		</div>
	</div>
	<div class="col-md-3" style="margin:10px">
		<div class="well">
			<div class="page-header" style="margin-top:10px;"><h4 class="text-muted">爬虫状态及操作</h4></div>
			<div id="crawlerStatus" style="" class="text-center">
				<span id="crawlerTitle">全局爬虫</span>
				<span>: </span>
				<span class="label label-success"><span>运行中 </span><span class="badge">2</span></span>
				<p style="margin-top:10px;"><button class="btn btn-sm btn-primary ">运行</button></p>
			</div>
		</div>
		
		<div class="panel panel-info">
			<div class="panel-heading">运行中的爬虫</div>
		</div>
		
	</div>
	<div class="col-md-6 text-center" style="margin:10px; padding: 0" id="logsPanel">
		<div class="panel panel-warning">
			<div class="panel-heading">日志</div>
		</div>
	</div>
</div>

<% include footer.html %>